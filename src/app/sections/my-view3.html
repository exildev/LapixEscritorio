<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../elements.html">

<dom-module id="my-view3">

    <template>
        <style>
            :host {
                display: block;
            }

            paper-toolbar{
                --paper-toolbar-background: #cfd8dd;
                --paper-toolbar-color: #000;
            }
        </style>
        <iron-ajax id="set" handle-as="json" content-type="application/x-www-form-urlencoded" method="post"></iron-ajax>
        <app-header condenses reveals effects="waterfall">
            <paper-toolbar class="tall">
                <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                <div class="title">Lapix</div>
                <paper-icon-button icon="cached" on-tap="_winReload"></paper-icon-button>
                <paper-icon-button icon="bug-report" on-tap="_openDevTools"></paper-icon-button>
            </paper-toolbar>
        </app-header>
        <lapix-table id="dt" site="usuarios/list/profesores/" label="Profesores" property="identificacion">
            <paper-datatable-column header="IdentificaciÃ³n" type="String" property="identificacion" sortable></paper-datatable-column>
            <paper-datatable-column header="Profesor" property="nombre">
                <template>
                    <span>{{value.first_name}}</span>
                    <span>{{value.last_name}}</span>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Horario" property="horario" editable>
                <template>
                    <paper-icon-button icon="horario"></paper-icon-button>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Actividades" property="actividades" editable>
                <template>
                    <paper-icon-button icon="actividades"></paper-icon-button>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Estado" property="status" editable>
                <template>
                    <paper-toggle-button checked="{{value}}"></paper-toggle-button>
                </template>
            </paper-datatable-column>
        </lapix-table>
    </template>

    <script>
        Polymer({
            is: 'my-view3',
            behaviors: [LapixBehavior],
            listeners: {
                'set.response': '_onResponse',
                'set.error': '_onError'
            },
            ready: function() {
                this.$.dt._dataSource.set = (item, property, value) => {
                    let aux = item;
                    this.$.set.url = lapix.conf.get('host') + aux.servicios.edit;
                    aux['first_name'] = aux.nombre.first_name;
                    aux['last_name'] = aux.nombre.last_name;
                    delete aux.nombre;
                    delete aux.actividades;
                    delete aux.servicios;
                    delete aux.horario;
                    this.$.set.body = aux;
                    this.$.set.generateRequest();
                    return new Promise((resolve, reject) => {
                        this._onResponse = evn => {
                            resolve(true);
                        }
                        this._onError = evn => {
                            console.warn('no se pudueron guardar los cambios');
                            resolve(false);
                        }
                    })
                };
            },
        });
    </script>

</dom-module>
